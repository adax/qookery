<?xml version="1.0" encoding="utf-8"?>
<!-- 
	A table with row addition, removal and editing in a separate form
-->
<form xmlns="http://www.qookery.org/ns/Form" column-flexes="1">

	<bind key="demo" type="scripting-context" uri="qookerydemo.DemoContext" required="true" />
	<bind key="qookery" type="scripting-context" uri="qookery.impl.QookeryContext" required="true" />

	<script>
		$.addRow = function() {
			var rowModel = $.demo.createModel({ "username": "", "password": "" });
			$.qookery.openWindow("resource/qookerydemo/xml/newEntryDialog.xml", rowModel, function(result) {
				if(result == "OK") $("#passwordsTable").addRow(rowModel);
			}, "Add Row Model");
		};
		$.removeRow = function() {
			var table = $("#passwordsTable");
			if(table.getSelectedRowIndex() == undefined) return;
			table.removeRow(table.getSelectedRowIndex());
		};
		$.editSelectedRow = function() {
			var table = $("#passwordsTable");
			if(table.getSelectedRowIndex() == undefined) return;
			var rowModel = $.demo.cloneModel(table.getRow(table.getSelectedRowIndex()));
			$.qookery.openWindow("resource/qookerydemo/xml/newEntryDialog.xml", rowModel, function(result) {
				if(result == "OK") table.replaceRow(table.getSelectedRowIndex(), rowModel);
			}, "Edit Row Model");
		};
	</script>

	<composite column-count="3" column-flexes="0 1 0">
		<table id="passwordsTable" connect="passwords">
			<script>
				this.initialize({
					columns: [
						{ connect: "password", label: "Password" },
						{ connect: "username", label: "Username", sortable: false, editable: true,  }
					]
				});
			</script>
			<script event="cellDblclick">
				$.editSelectedRow();
			</script>
		</table>
		<composite alignment-x="right">
			<button label="Add Row">
				<script event="execute">
					$.addRow();
				</script>
			</button>
			<button label="Delete Row">
				<script event="execute">
					$.removeRow();
				</script>
			</button>
			<button label="Edit Row">
				<script event="execute">
					$.editSelectedRow();
				</script>
			</button>
		</composite>
	</composite>
	
</form>
