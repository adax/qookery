<?xml version="1.0" encoding="utf-8"?>
<!-- 
	A table with row addition, removal and editing in a separate form
-->
<form xmlns="http://www.qookery.org/ns/Form" column-count="2" column-flexes="1 0" row-flexes="0 1">

	<import class="qookery.contexts.Qookery" />
	<import class="qookerydemo.contexts.QookeryDemo" />

	<label label="Hacker-ProofÂ® Password Manager" column-span="2" />

	<table id="passwords" connect="passwords" label="%none">
		<table-column connect="serial" label="Serial #" width="S" align="center" />
		<table-column connect="username" label="Username" width="1*" />
		<table-column connect="password" label="Password" width="1*" />
		<table-model class="qookery.impl.DefaultTableModel" />
		<script event="cellDblclick">
			$("#editButton").execute();
		</script>
	</table>

	<composite alignment-x="right">
		<button label="Add Password">
			<script event="execute">
				var newModel = $.QookeryDemo.createModel({ username: "", password: "", serial: "de ad be ef" });
				$.Qookery.openWindow($("#editor"), newModel, function(result) {
					if(result == "OK") $("#passwords").addRow(newModel);
				}, "Add Password");
			</script>
		</button>
		<button label="Edit Password" id="editButton">
			<script event="execute">
				var currentModel = $("#passwords").getSelectedRowModel();
				if(!currentModel) return;
				var clonedModel = $.QookeryDemo.cloneModel(currentModel);
				$.Qookery.openWindow($("#editor"), clonedModel, function(result) {
					if(result == "OK") $("#passwords").replaceRow($("#passwords").getSelectedRowIndex(), clonedModel);
				}, "Edit Password");
			</script>
		</button>
		<button label="Remove Password">
			<script event="execute">
				if($("#passwords").getSelectedRowIndex() == undefined) return;
				$("#passwords").removeRow($("#passwords").getSelectedRowIndex());
			</script>
		</button>
	</composite>
	
	<form display="none" id="editor" column-flexes="1">
	
		<composite column-count="2" column-flexes="0 1"> 
			<text-field label="User name" required="true" connect="username" />
			<password-field label="Password" required="true" connect="password" />
		</composite>
	
		<composite column-count="auto" max-width="300" alignment-x="right" column-flexes="1 1">
			<button label="OK">
				<script event="execute">
					if(!$.form.validate()) return;
					$.form.close("OK");
				</script>
			</button>
			<button label="Cancel">
				<script event="execute">
					$.form.close("Cancel");
				</script>
			</button>
		</composite>
	
	</form>

</form>
