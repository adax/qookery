<?xml version="1.0" encoding="utf-8"?>
<!-- 
	A table with row addition, removal and editing in a separate form
-->
<form xmlns="http://www.qookery.org/ns/Form" column-count="2" column-flexes="1 0" row-flexes="0 1">

	<import class="qookery.contexts.Qookery" />
	<import class="qookerydemo.contexts.QookeryDemo" />

	<label label="Hacker-ProofÂ® Password Manager" column-span="2" />

	<table id="passwords" connect="passwords" label="%none">
		<table-model class="qookery.impl.DefaultTableModel" />
		<table-column connect="serial" label="Serial #" width="S" text-align="center" />
		<table-column connect="username" label="Username" width="1*" />
		<table-column connect="password" label="Password" width="1*" />
		<script event="cellDbltap">
			$("#editButton").execute();
		</script>
		<script event="changeSelection">
			var enabled = event.getData() !== null;
			$("#editButton").setEnabled(enabled);
			$("#removeButton").setEnabled(enabled);
		</script>
	</table>

	<composite alignment-x="right">
		<button label="Add Password">
			<script event="execute">
				$.Qookery.openWindow($("#editor"), {
					model: $.QookeryDemo.createModel({ username: "New user", password: "", serial: "de ad be ef" }), 
					onDisappear: function(result) {
						if(result) $("#passwords").getTableModel().appendRow(result);
					}
				});
			</script>
		</button>
		<button label="Edit Password" id="editButton" enabled="false">
			<script event="execute">
				$.Qookery.openWindow($("#editor"), {
					model: $.QookeryDemo.cloneModel($("#passwords").getSelectedRowData()), 
					onDisappear: function(result) {
						if(result) $("#passwords").getTableModel().replaceRow(
							$("#passwords").getSelectedRowIndex(), result);
					}
				});
			</script>
		</button>
		<button label="Remove Password" id="removeButton" enabled="false">
			<script event="execute">
				if($("#passwords").getSelectedRowIndex() == undefined) return;
				$("#passwords").getTableModel().removeRow($("#passwords").getSelectedRowIndex());
			</script>
		</button>
	</composite>
	
	<form display="none" id="editor" column-flexes="1" title="Password Editor">

		<composite column-count="2" column-flexes="0 1"> 
			<text-field label="Serial #" connect="serial" read-only="true" appearance="label" />
			<text-field label="User name" required="true" connect="username" />
			<password-field label="Password" required="true" connect="password" />
		</composite>
	
		<composite column-count="auto" max-width="300" alignment-x="right" column-flexes="1 1">
			<button label="OK">
				<script event="execute">
					if($.form.validate()) return;
					$.form.close($.form.getModel());
				</script>
			</button>
			<button label="Cancel">
				<script event="execute">
					$.form.close(null);
				</script>
			</button>
		</composite>
	
	</form>

</form>
